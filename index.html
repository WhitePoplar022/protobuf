<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="https://eigenein.github.io/protobuf">
    <meta name="description" content="Protocol Buffers in Python">
    <meta property="og:description" content="Protocol Buffers in Python">
    <meta property="og:locale" content="en">
    <meta property="og:site_name" content="eigenein">
    <meta property="og:title" content="eigenein">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://eigenein.github.io/protobuf">
    <meta property="article:author" content="Pavel Perestoronin">
    <meta property="article:section" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:domain" content="eigenein">
    <meta name="twitter:url" content="https://eigenein.github.io/protobuf">
    <meta name="twitter:site" content="https://eigenein.github.io/protobuf">
    <meta name="twitter:creator" content="Pavel Perestoronin">
    <meta name="twitter:title" content="eigenein">
    <meta name="twitter:description" content="Protocol Buffers in Python">
    <title>Protocol Buffers in Python</title>
    <link rel="canonical" href="https://eigenein.github.io/protobuf">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.1.0/css/bulma.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/419722b477.css">
    <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16">
  </head>
  <body>
    <section class="hero is-info">
      <div class="hero-head">
        <header class="nav">
          <div class="container">
            <div class="nav-left">
              <a class="nav-item" href="">
                <img src="favicon-32x32.png" alt="Logo">
              </a>
            </div>
          </div>
        </header>
      </div>

      <div class="hero-body">
        <div class="container">
          <h1 class="title">Protocol Buffers in Python</h1>
          <h2 class="subtitle">Own flexible implementation of Protocol Buffers in pure Python</h2>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <h3 class="title">Features</h3>
        <div class="columns">
          <div class="column is-6">
            <div class="content">
              <ul>
                <li>Compatible with Google's one.</li>
                <li>Supports required, packed and packed repeated fields.</li>
                <li>Supports embedded messages.</li>
                <li>Supports streaming of several messages.</li>
                <li>Provides self-describing messages.</li>
                <li>Easily extensible.</li>
              </ul>
            </div>
          </div>
          <div class="column is-6 has-text-centered">
            <a class="button is-large is-info" href="https://github.com/eigenein/protobuf" target="_blank">
              <span class="icon">
                <i class="fa fa-github"></i>
              </span>
              <span>GitHub</span>
            </a>
            <a class="button is-large is-info" href="https://github.com/eigenein/protobuf/fork" target="_blank">
              <span>Fork</span>
            </a>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <h3 class="title">Introduction</h3>

        <div class="columns">
          <div class="column is-6">
            <p>Hereinafter assume that everything is imported into the global namespace:</p>
          </div>
          <div class="column is-6">
            <pre><code class="python">from encoding import *</code></pre>
          </div>
        </div>

        <div class="columns">
          <div class="column is-6">
            <p>Assume you have the following definition:</p>
          </div>
          <div class="column is-6">
            <pre><code class="python">message Test2 {
  string b = 2;
}</code></pre>
          </div>
        </div>

        <div class="columns">
          <div class="column is-6">
            <p>First, you should create the message type:</p>
          </div>
          <div class="column is-6">
            <pre><code class="python">Test2 = MessageType()
Test2.add_field(2, 'b', String)</code></pre>
          </div>
        </div>

        <div class="columns">
          <div class="column is-6">
            <p>Then, create a message and fill it with the appropriate data:</p>
          </div>
          <div class="column is-6">
            <pre><code>msg = Test2()
msg.b = 'Hello, world'</code></pre>
          </div>
        </div>

        <div class="columns">
          <div class="column is-6">
            <p>You can serialize it easily:</p>
          </div>
          <div class="column is-6">
            <pre><code>print msg.dumps()                     # This will dump into a string.
msg.dump(open('/tmp/message', 'wb'))  # Or any write-like object.</code></pre>
          </div>
        </div>

        <div class="columns">
          <div class="column is-6">
            <p>You also can deserialize this message with:</p>
          </div>
          <div class="column is-6">
            <pre><code>msg = Test2.load(open('/tmp/message', 'rb'))</code></pre>
          </div>
        </div>

        <h3 class="title">Required field</h3>

        <div class="columns">
          <div class="column is-6">
            <div class="content">
              <p>
                To add a missing field you should pass an additional
                <code>flags</code> parameter to <code>add_field</code>.
              </p>
              <p>If you'll not fill in a required field, then <code>ValueError</code> will be raised during serialization.</p>
            </div>
          </div>
          <div class="column is-6">
            <pre><code>Test2 = MessageType()
Test2.add_field(2, 'b', String, flags=Flags.REQUIRED)</code></pre>
          </div>
        </div>

        <h3 class="title">Repeated field</h3>

        <div class="columns">
          <div class="column is-6">
            <p>
              An input value of repeated field can be any iterable object.
              The loaded value will always be <code>list</code>.
            </p>
          </div>
          <div class="column is-6">
            <pre><code>Test2 = MessageType()
Test2.add_field(1, 'b', UVarint, flags=Flags.REPEATED)
msg = Test2()
msg.b = (1, 2, 3)</code></pre>
          </div>
        </div>

        <h3 class="title">Packed repeated field</h3>

        <div class="columns">
          <div class="column is-6">
            <!-- TODO -->
          </div>
          <div class="column is-6">
            <pre><code>Test4 = MessageType()
Test4.add_field(4, 'd', UVarint, flags=Flags.PACKED_REPEATED)
msg = Test4()
msg.d = (3, 270, 86942)</code></pre>
          </div>
        </div>

        <h2 class="title">Embedded messages</h2>

        <div class="columns">
          <div class="column is-6">
            <p>Consider the following definitions:</p>
          </div>
          <div class="column is-6">
            <pre><code>message Test1 {
  int32 a = 1;
}

message Test3 {
  required Test1 c = 3;
}</code></pre>
          </div>
        </div>

        <div class="columns">
          <div class="column is-6">
            <p>To create an embedded field, pass <code>EmbeddedMessage</code> as the type of field and fill it like this:</p>
          </div>
          <div class="column is-6">
            <pre><code># Create the type.
Test1 = MessageType()
Test1.add_field(1, 'a', UVarint)
Test3 = MessageType()
Test3.add_field(3, 'c', EmbeddedMessage(Test1))

# Fill in the message.
msg = Test3()
msg.c = Test1()
msg.c.a = 150</code></pre>
          </div>
        </div>

        <h3 class="title">Supported Data Types</h3>

        <div class="columns">
          <div class="column is-6">
            <p>There are the following data types supported for now:</p>
          </div>
          <div class="column is-6">
            <pre><code>UVarint             # Unsigned integer.
Varint              # Signed integer.
Bool                # Boolean.
Fixed64             # 8-byte string.
UInt64              # C++'s 64-bit `unsigned long long`
Int64               # C++'s 64-bit `long long`
Float64             # C++'s `double`.
Fixed32             # 4-byte string.
UInt32              # C++'s 32-bit `unsigned int`.
Int32               # C++'s 32-bit `int`.
Float32             # C++'s `float`.
Bytes               # Pure bytes string.
Unicode             # Unicode string.
TypeMetadata        # Type that describes another type.</code></pre>
          </div>
        </div>

        <h3 class="title">Streaming messages</h3>

        <div class="content">
          <p>
            The Protocol Buffer format is not self delimiting.
            But you can wrap you message type in <code>EmbeddedMessage</code> class and write/read it sequentially.
          </p>
          <p>
            The other option is to use <code>protobuf.EofWrapper</code> that has a <code>limit</code> parameter in its constructor.
            The <code>EofWrapper</code> raises <code>EOFError</code> when the specified number of bytes is read.
          </p>
        </div>

        <h3 class="title">Self-describing messages and <code>TypeMetadata</code></h3>

        <div class="columns">
          <div class="column is-6">
            <p>
              There is no any description of the message type in a message itself.
              Therefore, if you want to send a self-described messages, you should send the a description of the message too.
            </p>
          </div>
          <div class="column is-6">
            <pre><code>A, B, C = MessageType(), MessageType(), MessageType()
A.add_field(1, 'a', UVarint)
A.add_field(2, 'b', TypeMetadata, flags=Flags.REPEATED)
A.add_field(3, 'c', Bytes)
B.add_field(4, 'ololo', Float32)
B.add_field(5, 'c', TypeMetadata, flags=Flags.REPEATED)
B.add_field(6, 'd', Bool, flags=Flags.PACKED_REPEATED)
C.add_field(7, 'ghjhdf', UVarint)
msg = A()
msg.a = 1
msg.b = [B, C]
msg.c = 'ololo'
bytes = msg.dumps()
...
msg = A.loads(bytes)
msg2 = msg.b[0]()</code></pre>
          </div>
        </div>

        <h3 class="title"><code>add_field</code> chaining</h3>

        <div class="columns">
          <div class="column is-6">
            <p><code>add_field</code> return the message type itself, thus you can do in this way:</p>
          </div>
          <div class="column is-6">
            <pre><code>MessageType().add_field(
    1, 'a', EmbeddedMessage(MessageType().add_field(1, 'a', UVarint)))</code></pre>
          </div>
        </div>

        <h3 class="title">More info</h3>

        <div class="content">
          <p>
            See <code>protobuf</code> to see the API and <code>run-tests</code> modules to see more usage examples.
            The code should be well-documented.
          </p>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="container">
        <div class="content has-text-centered">
          <p>
            <a href="http://eigenein.me" target="_blank">Pavel Perestoronin</a> &copy; 2011-2016.
            Made with <a href="http://bulma.io/" target="_blank">Bulma</a>.
            Icons by <a href="https://fortawesome.github.io/Font-Awesome/" target="_blank">Font Awesome</a>.
          </p>
        </div>
      </div>
    </footer>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter34092110 = new Ya.Metrika({ id:34092110, clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks"); </script> <noscript><div><img src="https://mc.yandex.ru/watch/34092110" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-65034198-5', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
